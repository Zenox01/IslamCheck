!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.cassetteCore=t(require("react"),require("prop-types")):e.cassetteCore=t(e.React,e.PropTypes)}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist",n(n.s=7)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a});const i=console.log.bind(console),s=console.error?console.error.bind(console):i,a=console.warn?console.warn.bind(console):i},function(e,t,n){"use strict";(function(e){var i=n(0),s=n(2);const a=n(6).version,r="undefined"==typeof window?e:window;r.__cassette_contexts__=r.__cassette_contexts__||{},t.a=function(e){let t=e.displayName,n=e.defaultValue,o=void 0===n?null:n,l=e.keysWillUpdate;const d=r.__cassette_contexts__[t];if(d)return d.packageVersion!==a&&Object(s.b)(`Warning: multiple versions of ${t} from the @cassette/core`+` package have been loaded. v${a} will be ignored and`+` v${d.packageVersion} will be used instead.`),d;const c={};let u=0;for(const e of l)c[e]=1<<u++;const h=Object(i.createContext)(o,function(e,t){let n=0;for(const i of l)e[i]!==t[i]&&(n|=c[i]);return n});return h.__cassetteGetObservedBits=(e=>{let t=0;for(const n of e)t|=c[n];return t}),h.displayName=t,h.packageVersion=a,r.__cassette_contexts__[t]=h,h}}).call(this,n(5))},function(e,t,n){"use strict";e.exports=function(e,t,n){if("function"==typeof Array.prototype.findIndex)return e.findIndex(t,n);if("function"!=typeof t)throw new TypeError("predicate must be a function");var i=Object(e),s=i.length;if(0===s)return-1;for(var a=0;a<s;a++)if(t.call(n,i[a],a,i))return a;return-1}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e){e.exports={name:"@cassette/core",version:"2.0.0-beta.2",description:"A simple, clean, and responsive visual wrapper for the HTML audio tag, built with React.",main:"dist/es5/cassette-core.js",scripts:{"build:clean":"rimraf dist","build:webpack":"BUILD_MODE=all webpack --progress",build:"npm run build:clean && npm run build:webpack",prepare:"npm run build",test:'echo "Error: no test specified" && exit 1'},repository:{type:"git",url:"https://github.com/benwiley4000/cassette.git"},engines:{node:">=6.0.0",npm:">=5.0.0"},keywords:["audio","video","media","ui","react","reactjs","responsive","music","player","html5","component","components"],author:{name:"Ben Wiley",email:"therealbenwiley@gmail.com",url:"http://benwiley.org/"},license:"MIT",peerDependencies:{react:"^16.3.0"},devDependencies:{"array-find-index":"^1.0.2",rimraf:"^2.5.4",webpack:"^4.17.1"},dependencies:{"prop-types":"^15.5.10"},publishConfig:{access:"public"},gitHead:"6466d6adfdf7bfec0b01459e8636712cf912e5ae"}},function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"controlKeyword",function(){return y}),n.d(i,"control",function(){return b}),n.d(i,"crossOriginAttribute",function(){return k}),n.d(i,"repeatStrategy",function(){return v}),n.d(i,"mediaSource",function(){return T}),n.d(i,"mediaSessionAction",function(){return P}),n.d(i,"mediaSessionArtwork",function(){return S}),n.d(i,"track",function(){return E}),n.d(i,"seekMode",function(){return x});var s=n(0),a=n.n(s),r=n(4),o=n.n(r),l=n(3),d=Object(l.a)({displayName:"PlayerContext",keysWillUpdate:["playlist","activeTrackIndex","trackLoading","paused","currentTime","seekPreviewTime","seekInProgress","awaitingPlayResume","duration","bufferedRanges","playedRanges","seekableRanges","volume","muted","shuffle","stalled","playbackRate","setVolumeInProgress","repeatStrategy","mediaCannotPlay"]}),c=Object(l.a)({displayName:"GroupContext",keysWillUpdate:["groupProps"]}),u=n(1),h=n.n(u);const p=["none","playlist","track"],m=2;var f=n(2);function g(e,t){let n=!1;return function(i,s,a){if(s in i){!n&&t in i&&(Object(f.b)(`Do not define both the '${s}' and '${t}' props.`),n=!0);for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];return e.isRequired(i,s,a,...o)}if(!(t in i))return new Error(`If the '${t}' prop is not defined, '${s}' must be.`)}}const y=h.a.oneOf(["playpause","backskip","forwardskip","volume","mute","repeat","shuffle","progress","progressdisplay","fullscreen","spacer"]),b=h.a.oneOfType([h.a.func,y]),k=h.a.oneOf(["anonymous","use-credentials"]),v=h.a.oneOf(p),T=h.a.shape({src:h.a.string.isRequired,type:h.a.string.isRequired}),P=h.a.oneOf(["play","pause","previoustrack","nexttrack","seekbackward","seekforward"]),S=h.a.shape({src:h.a.string.isRequired,sizes:h.a.string,type:h.a.string}),E=h.a.shape({url:g(h.a.string,"sources"),sources:g(h.a.arrayOf(T.isRequired),"url"),title:h.a.string.isRequired,artist:h.a.string,album:h.a.string,artwork:h.a.arrayOf(S.isRequired),duration:h.a.oneOfType([h.a.string,h.a.number]),startingTime:h.a.number,isUnboundedStream:h.a.bool,meta:h.a.object}),x=h.a.oneOf(["paused","immediate","onrelease"]),w="loopchange",O="srcrequest";var M=function(e){return new MutationObserver(()=>{e.dispatchEvent(new Event(w))}).observe(e,{attributes:!0,attributeFilter:["loop"]}),Object.defineProperty(e,"src",{get:()=>e.currentSrc,set:t=>{const n=new Event(O);n.srcRequested=t,e.dispatchEvent(n)}}),e};function C(e,t,n,i){let s=i;for(let i=0;i<e;i++){if(!t.length)throw C(i,n,t,s),`Moving ${e} places was not possible!`;n.push(s),s=t.pop()}return s}function _(e,t,n,i,s){let a,r=i;if(e.length){for(let i=1;i<=t.length;i++)if(-1!==e.indexOf(t[t.length-i]))return C(i,t,n,r);if(s){if(function(e,t){if(!e.length)return!1;for(let n=0;n<e.length;n++)if(t!==e[n])return!1;return!0}(e,r))return r;do{a=e[Math.floor(Math.random()*e.length)]}while(r===a||void 0===a);return void 0!==(r=C(t.length,t,n,r))&&n.push(r),a}}}var L=class{constructor(e,t){void 0===t&&(t={}),this._list=e,this._forwardStack=[],this._backStack=[],this._currentItem=void 0,this._allowBackShuffle=Boolean(t.allowBackShuffle)}findNextItem(e){return void 0!==e&&this.setCurrentIndex(e),this._currentItem=_(this._list,this._forwardStack,this._backStack,this._currentItem,!0),this._currentItem}findPreviousItem(e){return void 0!==e&&this.setCurrentIndex(e),this._currentItem=_(this._list,this._backStack,this._forwardStack,this._currentItem,this._allowBackShuffle),this._currentItem}pickNextItem(e,t){if(void 0!==t&&this.setCurrentIndex(t),void 0!==this._list[e])return void 0!==this._currentItem&&this._backStack.push(this._currentItem),this._forwardStack.length=0,this._currentItem=this._list[e],this._currentItem}setList(e){this._list=e}setOptions(e){for(const t of Object.keys(e))switch(t){case"allowBackShuffle":this[`_${t}`]=Boolean(e[t])}}setCurrentIndex(e){const t=this._list[e];this._currentItem!==t&&(this.clear(),this._currentItem=t)}clear(){this._forwardStack.length=0,this._backStack.length=0,this._currentItem=void 0}};var I=function(e){return Boolean(e&&e.length)};const F=[{src:""}];var R=function(e,t){if(!I(e))return F;const n=e[t],i=n.sources,s=n.url;return i?i.length?i:F:[{src:s}]};var j=function(e,t){return o()(e,e=>e.sources?-1!==o()(e.sources,e=>e.src===t):e.url&&t===e.url)};function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const q="__highly_unstable_snapshot_internals_which_will_break_your_app_if_you_use_them_directly__",A="__cassette_snapshot_version__",H=[e=>{const t=e.__unstable__;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){V(e,t,n[t])})}return e}({},function(e,t){if(null==e)return{};var n,i,s={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,["__unstable__"]),{[q]:t})}];var B=function(e){return(e||[]).map((t,n)=>R(e,n)[0].src)};var U=function(e){const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={start:e.start(n),end:e.end(n)};return t};var D=function(e,t){return e?"track":t?"playlist":"none"};var N=function(e,t,n){return t="number"==typeof t?t:-1/0,n="number"==typeof n?n:1/0,Math.max(t,Math.min(e,n))};var $=function(e){return e?e.title&&e.artist?`${e.artist} - ${e.title}`:e.title||e.artist||e.album||"":""};var W=function(e){let t=0,n=1;const i=e.split(":").slice(-3);for(;i.length>0;)t+=n*parseInt(i.pop(),10),n*=60;return t};var z=function(e){let t=0;return e.duration&&(t="string"==typeof e.duration?W(e.duration):e.duration),t};function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){J(e,t,n[t])})}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){if(Object(f.a)(e),"NotAllowedError"===e.name){const e="Media playback failed at "+(new Date).toLocaleTimeString()+"! (Perhaps autoplay is disabled in this browser.)";Object(f.b)(e)}}const X=["previoustrack","nexttrack","seekbackward","seekforward"],Y={paused:!0,currentTime:0,seekPreviewTime:0,seekInProgress:!1,awaitingResumeOnSeekComplete:!1,awaitingPlayAfterTrackLoad:!1,duration:0,bufferedRanges:[],playedRanges:[],seekableRanges:[],stalled:!1,shouldRequestPlayOnNextUpdate:!1,mediaCannotPlay:!1,maxKnownTime:0};function Z(e){let t=e.prevState,n=e.index,i=e.track,s=e.shouldPlay,a=void 0===s||s,r=e.shouldForceLoad,o=void 0!==r&&r,l=e.startingTime;const d=t.activeTrackIndex!==n,c=Boolean(d||o),u=l||i.startingTime||0;return{duration:z(i),activeTrackIndex:n,trackLoading:c,mediaCannotPlay:t.mediaCannotPlay&&!c,currentTime:N(u,0),loop:!c&&t.loop,shouldRequestPlayOnNextUpdate:Boolean(a),awaitingPlayAfterTrackLoad:Boolean(a),awaitingForceLoad:Boolean(o),maxKnownTime:c?0:t.maxKnownTime}}class ee extends s.Component{constructor(e){super(e);let t=0,n=N(e.startingTrackIndex,0);const i=I(e.playlist);i&&e.playlist[n]&&(t=e.playlist[n].startingTime||0);const s=e.initialStateSnapshot;let a={};if(s)try{const i=a=function(e,t){const n=H.slice(e[A]||0).reduce((e,t)=>t(e),e)[q],i=n.paused,s=n.currentTime,a=n.activeTrackIndex,r=n.volume,o=n.muted,l=n.loop,d=n.cycle,c=n.shuffle,u=n.playbackRate,h=n.activeTrackSrc,p={};I(t.playlist)&&"boolean"==typeof i&&(p.awaitingPlay=!i),"number"==typeof r&&r>=0&&r<=1&&(p.volume=r),"boolean"==typeof o&&(p.muted=o),"boolean"==typeof l&&(p.loop=l),"boolean"==typeof d&&(p.cycle=d),"boolean"==typeof c&&(p.shuffle=c),"number"==typeof u&&(p.playbackRate=u);let m=!1;if("string"==typeof h&&"number"==typeof a&&a>=0){const e=t.playlist[a]&&R(t.playlist,a)[0].src;if(e&&h===e)p.activeTrackIndex=a,m=!0;else{const e=j(t.playlist,h);-1!==e&&(p.activeTrackIndex=e,m=!0)}}return m&&"number"==typeof s&&s>=0&&(p.currentTime=s),p}(s,e),r=i.activeTrackIndex,o=i.currentTime;"number"==typeof r&&(n=r),"number"==typeof o&&(t=o)}catch(e){Object(f.b)(e),Object(f.b)("Loading Cassette state from snapshot failed."),Object(f.b)(`Failed snapshot:\n${JSON.stringify(s,null,2)}`)}this.state=G({},Y,{activeTrackIndex:n,trackLoading:I(e.playlist),currentTime:N(t,0),volume:N(e.defaultVolume,0,1),muted:e.defaultMuted,loop:"track"===e.defaultRepeatStrategy,cycle:"playlist"===e.defaultRepeatStrategy,shuffle:e.defaultShuffle,playbackRate:e.defaultPlaybackRate,setVolumeInProgress:!1,shouldRequestPlayOnNextUpdate:e.autoplay&&i,awaitingForceLoad:!1,duration:z(i&&e.playlist[n]),__playlist__:e.playlist},a),this.lastStableVolume=this.state.volume,this.shuffler=new L(B(e.playlist),{allowBackShuffle:e.allowBackShuffle}),this.media=null,this.videoHostElementList=[],this.videoHostOccupiedCallbacks=new Map,this.videoHostVacatedCallbacks=new Map,this.handleTrackPlaybackFailure=this.handleTrackPlaybackFailure.bind(this),this.handlePlayerOnlineAfterFailure=this.handlePlayerOnlineAfterFailure.bind(this),this.togglePause=this.togglePause.bind(this),this.selectTrackIndex=this.selectTrackIndex.bind(this),this.forwardSkip=this.forwardSkip.bind(this),this.backSkip=this.backSkip.bind(this),this.seekPreview=this.seekPreview.bind(this),this.seekComplete=this.seekComplete.bind(this),this.setVolume=this.setVolume.bind(this),this.setVolumeComplete=this.setVolumeComplete.bind(this),this.toggleMuted=this.toggleMuted.bind(this),this.toggleShuffle=this.toggleShuffle.bind(this),this.setRepeatStrategy=this.setRepeatStrategy.bind(this),this.setPlaybackRate=this.setPlaybackRate.bind(this),this.registerVideoHostElement=this.registerVideoHostElement.bind(this),this.renderVideoIntoHostElement=this.renderVideoIntoHostElement.bind(this),this.unregisterVideoHostElement=this.unregisterVideoHostElement.bind(this),this.updateVideoHostElement=this.updateVideoHostElement.bind(this),this.handleMediaPlay=this.handleMediaPlay.bind(this),this.handleMediaPause=this.handleMediaPause.bind(this),this.handleMediaSrcrequest=this.handleMediaSrcrequest.bind(this),this.handleMediaEnded=this.handleMediaEnded.bind(this),this.handleMediaEmptied=this.handleMediaEmptied.bind(this),this.handleMediaStalled=this.handleMediaStalled.bind(this),this.handleMediaCanplaythrough=this.handleMediaCanplaythrough.bind(this),this.handleMediaCanplay=this.handleMediaCanplay.bind(this),this.handleMediaTimeupdate=this.handleMediaTimeupdate.bind(this),this.handleMediaLoadeddata=this.handleMediaLoadeddata.bind(this),this.handleMediaVolumechange=this.handleMediaVolumechange.bind(this),this.handleMediaDurationchange=this.handleMediaDurationchange.bind(this),this.handleMediaProgress=this.handleMediaProgress.bind(this),this.handleMediaLoopchange=this.handleMediaLoopchange.bind(this),this.handleMediaRatechange=this.handleMediaRatechange.bind(this)}componentDidMount(){const e=this.media=M(this.props.createMediaElement()),t=this.props,n=t.defaultPlaybackRate,i=t.crossOrigin,s=t.playlist,a=t.autoplayDelayInSeconds,r=t.mediaElementRef,o=t.getPosterImageForTrack,l=t.getMediaTitleAttributeForTrack,d=t.onActiveTrackUpdate,c=this.state,u=c.volume,h=c.muted,p=c.playbackRate,m=c.loop,f=c.activeTrackIndex,g=c.shouldRequestPlayOnNextUpdate;e.defaultPlaybackRate=n,i&&(e.crossOrigin=i),e.volume=u,e.muted=h,e.playbackRate=p,e.loop=m,e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.setAttribute("preload","metadata"),e.setAttribute("poster",o(s[f])),e.setAttribute("title",l(s[f])),e.addEventListener("play",this.handleMediaPlay),e.addEventListener("pause",this.handleMediaPause),e.addEventListener("ended",this.handleMediaEnded),e.addEventListener("stalled",this.handleMediaStalled),e.addEventListener("emptied",this.handleMediaEmptied),e.addEventListener("canplay",this.handleMediaCanplay),e.addEventListener("canplaythrough",this.handleMediaCanplaythrough),e.addEventListener("timeupdate",this.handleMediaTimeupdate),e.addEventListener("loadeddata",this.handleMediaLoadeddata),e.addEventListener("volumechange",this.handleMediaVolumechange),e.addEventListener("durationchange",this.handleMediaDurationchange),e.addEventListener("progress",this.handleMediaProgress),e.addEventListener("ratechange",this.handleMediaRatechange),e.addEventListener("error",this.handleTrackPlaybackFailure),e.addEventListener("srcrequest",this.handleMediaSrcrequest),e.addEventListener("loopchange",this.handleMediaLoopchange),this.setMediaElementSources(),this.mediaContainer.appendChild(e),g&&(this.setState({shouldRequestPlayOnNextUpdate:!1}),this.delayTimeout=setTimeout(()=>{this.togglePause(!1)},1e3*a)),r&&r(e),d&&d({track:s[f],trackIndex:f,previousTrack:null,previousTrackIndex:null})}static getDerivedStateFromProps(e,t){const n=e.playlist;if(n===t.__playlist__)return null;const i={__playlist__:n};if(!I(n))return G({},Y,i,{activeTrackIndex:0,trackLoading:!1});const s=R(t.__playlist__,t.activeTrackIndex);if(n[t.activeTrackIndex]){const e=R(n,t.activeTrackIndex);if(s[0].src===e[0].src)return i}const a=j(n,s[0].src);return-1!==a?G({},i,{activeTrackIndex:a}):G({},i,Z({prevState:t,track:n[0],index:0,shouldPlay:!1,shouldForceLoad:!0}),{mediaCannotPlay:!1,awaitingPlayAfterTrackLoad:!1})}componentDidUpdate(e,t){this.media.defaultPlaybackRate=this.props.defaultPlaybackRate,this.media.crossOrigin=this.props.crossOrigin,this.shuffler.setList(B(this.props.playlist)),this.shuffler.setOptions({allowBackShuffle:this.props.allowBackShuffle});const n=R(e.playlist,t.activeTrackIndex),i=R(this.props.playlist,this.state.activeTrackIndex),s=e.playlist[t.activeTrackIndex],a=this.props.playlist[this.state.activeTrackIndex];(this.state.awaitingForceLoad||n[0].src!==i[0].src)&&(this.setMediaElementSources(),this.media.setAttribute("poster",this.props.getPosterImageForTrack(a)),this.media.setAttribute("title",this.props.getMediaTitleAttributeForTrack(a)),this.setState({awaitingForceLoad:!1}),this.state.shuffle||this.shuffler.clear(),window.removeEventListener("online",this.handlePlayerOnlineAfterFailure)),this.props.onActiveTrackUpdate&&s!==a&&this.props.onActiveTrackUpdate({track:a,trackIndex:this.state.activeTrackIndex,previousTrack:s,previousTrackIndex:t.activeTrackIndex}),e===this.props||this.media.paused||this.stealMediaSession(),this.state.shouldRequestPlayOnNextUpdate&&(this.setState({shouldRequestPlayOnNextUpdate:!1}),setTimeout(()=>{this.togglePause(!1)})),clearTimeout(this.snapshotUpdateTimeout),this.snapshotUpdateTimeout=setTimeout(()=>{this.props.onStateSnapshot&&this.props.onStateSnapshot(function(e){const t=e.paused,n=e.currentTime,i=e.activeTrackIndex,s=e.volume,a=e.muted,r=e.loop,o=e.cycle,l=e.shuffle,d=e.playbackRate,c=e.duration,u=e.__playlist__;return{[A]:H.length,[q]:{paused:t,currentTime:c===1/0?0:n,activeTrackIndex:i,volume:s,muted:a,loop:r,cycle:o,shuffle:l,playbackRate:d,activeTrackSrc:I(u)?R(u,i)[0].src:null}}}(this.state))},100)}componentWillUnmount(){const e=this.media;if(e){e.removeEventListener("play",this.handleMediaPlay),e.removeEventListener("pause",this.handleMediaPause),e.removeEventListener("ended",this.handleMediaEnded),e.removeEventListener("stalled",this.handleMediaStalled),e.removeEventListener("emptied",this.handleMediaEmptied),e.removeEventListener("canplaythrough",this.handleMediaCanplaythrough),e.removeEventListener("canplay",this.handleMediaCanplay),e.removeEventListener("timeupdate",this.handleMediaTimeupdate),e.removeEventListener("loadeddata",this.handleMediaLoadeddata),e.removeEventListener("volumechange",this.handleMediaVolumechange),e.removeEventListener("durationchange",this.handleMediaDurationchange),e.removeEventListener("progress",this.handleMediaProgress),e.removeEventListener("ratechange",this.handleMediaRatechange),e.removeEventListener("error",this.handleTrackPlaybackFailure),e.removeEventListener("srcrequest",this.handleMediaSrcrequest),e.removeEventListener("loopchange",this.handleMediaLoopchange);const t=e.querySelectorAll("source");for(const e of t)e.removeEventListener("error",this.handleTrackPlaybackFailure)}clearTimeout(this.gapLengthTimeout),clearTimeout(this.delayTimeout),window.removeEventListener("online",this.handlePlayerOnlineAfterFailure)}stealMediaSession(){window.MediaSession&&navigator.mediaSession instanceof MediaSession&&(navigator.mediaSession.metadata=new MediaMetadata(this.props.playlist[this.state.activeTrackIndex]),X.map(e=>{if(-1===this.props.supportedMediaSessionActions.indexOf(e))return null;const t=this.props.mediaSessionSeekLengthInSeconds;switch(e){case"play":return this.togglePause.bind(this,!1);case"pause":return this.togglePause.bind(this,!0);case"previoustrack":return this.backSkip;case"nexttrack":return this.forwardSkip;case"seekbackward":return()=>this.media.currentTime-=t;case"seekforward":return()=>this.media.currentTime+=t;default:return}}).forEach((e,t)=>{navigator.mediaSession.setActionHandler(X[t],e)}))}setMediaElementSources(){const e=this.props.playlist;let t;for(;t=this.media.firstChild;)this.media.removeChild(t);if(I(e)){const t=R(e,this.state.activeTrackIndex);for(const e of t){const t=document.createElement("source");t.src=e.src,e.type&&(t.type=e.type),t.addEventListener("error",this.handleTrackPlaybackFailure),this.media.appendChild(t)}}this.media.load()}reloadActiveTrack(e){let t=(void 0===e?{}:e).shouldPlay,n=void 0!==t&&t;const i=this.props.playlist,s=this.state,a=s.activeTrackIndex,r=s.paused,o=s.currentTime;I(i)&&this.goToTrack({track:i[a],shouldForceLoad:!0,shouldPlay:n||!r,startingTime:o,index:a})}handlePlayerOnlineAfterFailure(){this.reloadActiveTrack(),window.removeEventListener("online",this.handlePlayerOnlineAfterFailure)}handleTrackPlaybackFailure(e){const t=!this.state.paused;this.setState({mediaCannotPlay:!0});const n=e.target.error;e.target===this.media&&n&&n.code===m&&(window.navigator.onLine?this.reloadActiveTrack({shouldPlay:t}):window.addEventListener("online",this.handlePlayerOnlineAfterFailure)),this.props.onTrackPlaybackFailure&&this.props.onTrackPlaybackFailure({track:this.props.playlist[this.state.activeTrackIndex],trackIndex:this.state.activeTrackIndex,event:e})}registerVideoHostElement(e,t){let n=t.onHostOccupied,i=t.onHostVacated;this.videoHostElementList=this.videoHostElementList.concat(e),this.videoHostOccupiedCallbacks.set(e,n),this.videoHostVacatedCallbacks.set(e,i)}renderVideoIntoHostElement(e){-1!==this.videoHostElementList.indexOf(e)&&(cancelAnimationFrame(this.videoHostUpdateRaf),this.videoHostUpdateRaf=requestAnimationFrame(()=>this.updateVideoHostElement(e)))}unregisterVideoHostElement(e){this.videoHostElementList=this.videoHostElementList.filter(t=>t!==e),this.videoHostOccupiedCallbacks.delete(e),this.videoHostVacatedCallbacks.delete(e),this.media.parentNode===e&&this.updateVideoHostElement()}updateVideoHostElement(e){e?this.videoHostElementList=[e].concat(this.videoHostElementList.filter(t=>t!==e)):e=this.videoHostElementList[0]||this.mediaContainer;const t=!this.media.paused,n=this.media.parentNode;if(e===n)return;e.appendChild(this.media),t&&this.media.paused&&this.media.play();const i=this.videoHostVacatedCallbacks.get(n);i&&i(this.media);const s=this.videoHostOccupiedCallbacks.get(e);s&&s(this.media)}handleMediaPlay(){this.setState(e=>!1===e.paused&&!1===e.awaitingPlayAfterTrackLoad?null:{paused:!1,awaitingPlayAfterTrackLoad:!1}),this.stealMediaSession()}handleMediaPause(){this.setState(e=>!0===e.paused?null:{paused:!0})}handleMediaSrcrequest(e){const t=this.props.playlist,n=R(t,this.state.activeTrackIndex);if(-1!==o()(n,t=>t.src===e.srcRequested))return;const i=j(t,e.srcRequested);-1!==i?this.selectTrackIndex(i):Object(f.a)(`Source '${e.srcRequested}' does not exist in the loaded playlist. `+"Make sure you've updated the 'playlist' prop to PlayerContextProvider before you select this track!")}handleMediaEnded(){if(this.state.seekInProgress)return;clearTimeout(this.gapLengthTimeout);const e=this.props,t=e.playlist,n=e.loadFirstTrackOnPlaylistComplete;if(!I(t))return;const i=this.state,s=i.cycle,a=i.activeTrackIndex;!s&&a+1>=t.length?n&&this.goToTrack({index:0,track:t[0],shouldPlay:!1,shouldForceLoad:!0}):this.gapLengthTimeout=setTimeout(this.forwardSkip,1e3*this.props.gapLengthInSeconds)}handleMediaStalled(){this.setState(e=>!0===e.stalled?null:{stalled:!0})}handleMediaEmptied(){this.setState(e=>!0===e.paused?null:{paused:!0})}handleMediaCanplay(){this.setState(e=>!1===e.trackLoading?null:{trackLoading:!1})}handleMediaCanplaythrough(){this.setState(e=>!1===e.stalled?null:{stalled:!1})}handleMediaTimeupdate(){const e=this.media,t=e.currentTime,n=e.played,i=this.props,s=i.onTimeUpdate,a=i.playlist,r=this.state,o=r.activeTrackIndex;r.trackLoading||(this.setState(e=>({currentTime:t,playedRanges:U(n),maxKnownTime:Math.max(e.maxKnownTime,t)})),s&&s({currentTime:t,track:a[o],trackIndex:o}))}handleMediaLoadeddata(){this.media.currentTime!==this.state.currentTime&&(this.media.currentTime=this.state.currentTime)}handleMediaVolumechange(){const e=this.media,t=e.volume,n=e.muted;this.setState({volume:t,muted:n})}handleMediaDurationchange(){const e=this.media.duration,t=this.props.playlist[this.state.activeTrackIndex];if(e===1/0)if(t.isUnboundedStream||t===this.activeTrackAtLastDurationChange)this.setState({duration:e,currentTime:0}),this.media.currentTime=0;else{const e=this.state.paused;this.media.load(),e||setTimeout(()=>{this.togglePause(!1)})}else this.setState({duration:e});this.activeTrackAtLastDurationChange=t}handleMediaProgress(){this.setState({bufferedRanges:U(this.media.buffered),seekableRanges:U(this.media.seekable)})}handleMediaLoopchange(){const e=this.media.loop;this.setState(t=>t.loop===e?null:{loop:e})}handleMediaRatechange(){const e=this.media.playbackRate;this.setState(t=>t.playbackRate===e?null:{playbackRate:e})}togglePause(e){if(clearTimeout(this.delayTimeout),"boolean"==typeof e?e:!this.state.paused)this.media.pause();else if(this.media.currentSrc)try{const e=this.media.play();e&&"function"==typeof e.catch&&e.catch(e=>{if("AbortError"!==e.name)return Promise.reject(e)}).catch(Q)}catch(e){Q(e)}}goToTrack(e){clearTimeout(this.delayTimeout),this.setState(t=>Z(G({prevState:t},e)))}selectTrackIndex(e){const t=this.props.playlist;I(t)&&(e<0||e>t.length?Object(f.b)(`Playlist index ${e} is out of bounds!`):(this.state.shuffle&&this.shuffler.pickNextItem(e,this.state.activeTrackIndex),this.goToTrack({index:e,track:t[e]})))}backSkip(){const e=this.props,t=e.playlist,n=e.stayOnBackSkipThreshold,i=this.media,s=this.state,a=s.cycle,r=s.activeTrackIndex,o=s.shuffle;if(!I(t)||i.currentTime>=n||!a&&r<1)return void(i.currentTime=0);let l;if(o){const e=this.shuffler.findPreviousItem(r);if(void 0===e)return void(i.currentTime=0);l=j(t,e)}else(l=r-1)<0&&(l=t.length-1);this.goToTrack({index:l,track:t[l],shouldForceLoad:!0})}forwardSkip(){const e=this.props.playlist,t=this.state,n=t.cycle,i=t.activeTrackIndex,s=t.shuffle;if(!I(e)||!n&&i+1>=e.length)return;let a;s?a=j(e,this.shuffler.findNextItem(i)):(a=i+1)>=e.length&&(a=0),this.goToTrack({index:a,track:e[a],shouldForceLoad:!0})}seekPreview(e){if(!I(this.props.playlist))return;const t={seekPreviewTime:e,seekInProgress:!0};switch(this.props.seekMode){case"paused":this.setState(n=>{let i=n.paused,s=n.awaitingResumeOnSeekComplete;return G({},t,{awaitingResumeOnSeekComplete:!i||s,currentTime:e})}),this.state.trackLoading||(this.media.currentTime=e),this.state.paused||this.togglePause(!0);break;case"immediate":this.setState(n=>{let i=n.paused,s=n.awaitingResumeOnSeekComplete;return G({},t,{awaitingResumeOnSeekComplete:!i||s,currentTime:e})}),this.state.trackLoading||(this.media.currentTime=e),this.state.awaitingResumeOnSeekComplete&&!this.media.ended&&this.togglePause(!1);break;case"onrelease":this.setState(t)}}seekComplete(e){const t=this.state,n=t.seekPreviewTime,i=t.awaitingResumeOnSeekComplete,s=t.trackLoading,a={seekInProgress:!1,awaitingResumeOnSeekComplete:!1},r="number"==typeof e?e:n;isNaN(r)?this.setState(a):(this.setState(G({},a,{currentTime:r})),s||(this.media.currentTime=r),i&&(this.media.ended?this.forwardSkip():this.togglePause(!1)))}setVolume(e,t){void 0===t&&(t=!0),t&&!this.state.setVolumeInProgress&&this.setState({setVolumeInProgress:!0});const n=N(e,0,1);this.media.muted=0===n,this.media.volume=n}setVolumeComplete(e){"number"==typeof e&&this.setVolume(e,!1),this.setState({setVolumeInProgress:!1}),this.media.muted||(this.lastStableVolume=this.media.volume)}toggleMuted(e){const t="boolean"==typeof e?e:!this.state.muted;this.media.muted=t,t||(this.media.volume=this.lastStableVolume)}toggleShuffle(e){const t="boolean"==typeof e?e:!this.state.shuffle;this.setState({shuffle:t})}setRepeatStrategy(e){if(-1!==p.indexOf(e))switch(e){case"track":this.media.loop=!0;break;case"playlist":this.setState({loop:!1,cycle:!0}),this.media.loop=!1;break;case"none":this.setState({loop:!1,cycle:!1}),this.media.loop=!1}else Object(f.b)('repeatStrategy "'+e+'" is not one of: '+p.split(", ")+".")}setPlaybackRate(e){this.media.playbackRate=e}getControlProps(){const e=this.props,t=this.state,n={playlist:e.playlist,activeTrackIndex:t.activeTrackIndex,trackLoading:t.trackLoading,paused:t.paused,currentTime:t.currentTime,seekPreviewTime:t.seekPreviewTime,seekInProgress:t.seekInProgress,awaitingPlayResume:t.awaitingResumeOnSeekComplete||t.awaitingPlayAfterTrackLoad,duration:t.duration===1/0?t.maxKnownTime:t.duration,bufferedRanges:t.bufferedRanges,playedRanges:t.playedRanges,seekableRanges:t.seekableRanges,volume:t.volume,muted:t.muted,shuffle:t.shuffle,stalled:t.stalled,playbackRate:t.playbackRate,mediaCannotPlay:t.mediaCannotPlay,setVolumeInProgress:t.setVolumeInProgress,repeatStrategy:D(t.loop,t.cycle),registerVideoHostElement:this.registerVideoHostElement,renderVideoIntoHostElement:this.renderVideoIntoHostElement,unregisterVideoHostElement:this.unregisterVideoHostElement,onTogglePause:this.togglePause,onSelectTrackIndex:this.selectTrackIndex,onBackSkip:this.backSkip,onForwardSkip:this.forwardSkip,onSeekPreview:this.seekPreview,onSeekComplete:this.seekComplete,onSetVolume:this.setVolume,onSetVolumeComplete:this.setVolumeComplete,onToggleMuted:this.toggleMuted,onToggleShuffle:this.toggleShuffle,onSetRepeatStrategy:this.setRepeatStrategy,onSetPlaybackRate:this.setPlaybackRate,reloadActiveTrack:this.reloadActiveTrack};if(this.playerContext){for(const e of Object.keys(this.playerContext))if(n[e]!==this.playerContext[e]){this.playerContext=n;break}}else this.playerContext=n;return this.playerContext}render(){const e=this.getControlProps();return a.a.createElement(s.Fragment,null,a.a.createElement("div",{ref:e=>this.mediaContainer=e,hidden:!0}),a.a.createElement(d.Provider,{value:e},"function"==typeof this.props.children?this.props.children(e):this.props.children))}}ee.defaultProps={autoplay:!1,autoplayDelayInSeconds:0,createMediaElement:()=>document.createElement("video"),gapLengthInSeconds:0,defaultVolume:1,defaultMuted:!1,defaultRepeatStrategy:"playlist",defaultShuffle:!1,defaultPlaybackRate:1,startingTrackIndex:0,loadFirstTrackOnPlaylistComplete:!0,seekMode:"immediate",maintainPlaybackRate:!1,allowBackShuffle:!1,stayOnBackSkipThreshold:5,supportedMediaSessionActions:["play","pause","previoustrack","nexttrack"],mediaSessionSeekLengthInSeconds:10,getPosterImageForTrack:e=>e&&e.artwork?e.artwork[0].src:"",getMediaTitleAttributeForTrack:$};class te extends s.Component{componentDidMount(){this.props.groupContext.registerMediaElement(this.mediaElement)}componentWillUnmount(){this.mediaElement&&this.props.groupContext.unregisterMediaElement(this.mediaElement)}render(){const e=this.props,t=e.groupContext,n=e.props,i=n.mediaElementRef,s=function(e,t){if(null==e)return{};var n,i,s={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(n,["mediaElementRef"]);return a.a.createElement(ee,K({},t.groupProps,s,{mediaElementRef:e=>{i&&i(e),this.mediaElement=e}}))}}var ne=function(e){return a.a.createElement(c.Consumer,null,t=>t?Object(s.createElement)(te,{groupContext:t,props:e}):Object(s.createElement)(ee,e))};var ie=function(e){const t=[];let n=e._reactInternalFiber;if(!n)return t;for(;n=n._debugOwner;)n.type.name&&t.push(n.type.name);return t};var se=class extends s.PureComponent{render(){const e=this.props,t=e.children,n=e.filterList;if(!n){if(!this.warnedAboutFilterList){let e="\n          Please pass the filterList prop to PlayerContextConsumer in order\n          to avoid unnecessarily frequent re-renders, e.g.\n\n          const filterList = ['paused', 'onTogglePause'];\n          // ...\n          <PlayerContextConsumer filterList={filterList}>\n            {({ paused, onTogglePause }) => {\n              return <div>{/* ... */}</div>;\n            }}\n          </PlayerContextConsumer>\n        ";for(const t of ie(this))e+=`\n            Rendered by ${t}`;Object(f.b)(e),this.warnedAboutFilterList=!0}return a.a.createElement(d.Consumer,null,t)}const i=d.__cassetteGetObservedBits(n);return a.a.createElement(d.Consumer,{unstable_observedBits:i},e=>{const i={};for(const t of n)e.hasOwnProperty(t)&&(i[t]=e[t]);return t(i)})}};function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){re(e,t,n[t])})}return e}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=class extends s.Component{constructor(e){super(e),this.registerMediaElement=this.registerMediaElement.bind(this),this.unregisterMediaElement=this.unregisterMediaElement.bind(this),this.enforceOneMediaSourceOnly=this.enforceOneMediaSourceOnly.bind(this),this.mediaElements=[]}registerMediaElement(e){this.mediaElements=this.mediaElements.concat(e),e.addEventListener("play",this.enforceOneMediaSourceOnly,!0),e.addEventListener("volumechange",this.enforceOneMediaSourceOnly,!0)}unregisterMediaElement(e){this.mediaElements=this.mediaElements.filter(t=>e!==t),e.removeEventListener("play",this.enforceOneMediaSourceOnly,!0),e.removeEventListener("volumechange",this.enforceOneMediaSourceOnly,!0)}enforceOneMediaSourceOnly(e){const t=e.target,n=t.paused,i=t.muted;if(!n&&!i)for(const e of this.mediaElements)e===t||e.muted||e.pause()}render(){return a.a.createElement(c.Consumer,null,e=>{const t=e?ae({},e,{groupProps:ae({},e.groupProps,this.props)}):{groupProps:this.props,registerMediaElement:this.registerMediaElement,unregisterMediaElement:this.unregisterMediaElement};return a.a.createElement(c.Provider,{value:t},this.props.children)})}},le=Object(l.a)({displayName:"FullscreenContext",defaultValue:{fullscreen:!1,requestFullscreen(){Object(f.b)("Fullscreen request ignored since there is no FullscreenContextProvider ancestor.")},requestExitFullscreen(){Object(f.b)("Exit fullscreen request ignored since there is no FullscreenContextProvider ancestor.")}},keysWillUpdate:["fullscreen"]});const de={width:"100%",height:"100%"};class ce extends s.PureComponent{constructor(e){super(e),this.state={fullscreen:!1},this.requestFullscreen=this.requestFullscreen.bind(this),this.requestExitFullscreen=this.requestExitFullscreen.bind(this),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),this.fullscreenElement=null}componentDidMount(){document.addEventListener("fullscreenchange",this.handleFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange),document.addEventListener("msfullscreenchange",this.handleFullscreenChange)}componentWillUnmount(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange)}requestFullscreen(){this.props.fullscreenEnabled&&(this.fullscreenElement.requestFullscreen?this.fullscreenElement.requestFullscreen():this.fullscreenElement.webkitRequestFullscreen?this.fullscreenElement.webkitRequestFullscreen():this.fullscreenElement.mozRequestFullscreen?this.fullscreenElement.mozRequestFullScreen():this.fullscreenElement.msRequestFullscreen&&this.fullscreenElement.msRequestFullscreen())}requestExitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.mozExitFullscreen()}handleFullscreenChange(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;this.setState({fullscreen:e===this.fullscreenElement})}getFullscreenContext(){const e={fullscreen:this.state.fullscreen,requestFullscreen:this.requestFullscreen,requestExitFullscreen:this.requestExitFullscreen};return this.fullscreenContext&&e.fullscreen===this.fullscreenContext.fullscreen?this.fullscreenContext:this.fullscreenContext=e}render(){const e=this.getFullscreenContext();return a.a.createElement("div",{ref:e=>this.fullscreenElement=e,style:this.state.fullscreen?de:void 0},a.a.createElement(le.Provider,{value:e},"function"==typeof this.props.children?this.props.children(e):this.props.children))}}ce.defaultProps={fullscreenEnabled:!0};var ue=ce;function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(e,t){const n={},i=e.displayName||e.name,r=d.__cassetteGetObservedBits(t);function o(o){return a.a.createElement(le.Consumer,null,l=>a.a.createElement(d.Consumer,{unstable_observedBits:r},a=>{const r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){he(e,t,n[t])})}return e}({},o);for(const e of t)a.hasOwnProperty(e)?r[e]=a[e]:l.hasOwnProperty(e)?r[e]=l[e]:n[e]||(Object(f.b)("Prop '"+e+"' for component "+i+" not found in playerContext or fullscreenContext."),n[e]=!0);return Object(s.createElement)(e,r)}))}return i&&(o.displayName=`PlayerContextFilter(${i})`),o};n.d(t,"FullscreenContextConsumer",function(){return me}),n.d(t,"donotuse_PlayerContext",function(){return fe}),n.d(t,"donotuse_FullscreenContext",function(){return ge}),n.d(t,"PlayerContextProvider",function(){return ne}),n.d(t,"PlayerContextConsumer",function(){return se}),n.d(t,"PlayerContextGroup",function(){return oe}),n.d(t,"FullscreenContextProvider",function(){return ue}),n.d(t,"playerContextFilter",function(){return pe}),n.d(t,"PlayerPropTypes",function(){return i}),n.d(t,"logError",function(){return f.a}),n.d(t,"logWarning",function(){return f.b}),n.d(t,"convertToNumberWithinIntervalBounds",function(){return N}),n.d(t,"isPlaylistValid",function(){return I}),n.d(t,"getDisplayText",function(){return $}),n.d(t,"repeatStrategyOptions",function(){return p});const me=le.Consumer,fe=d,ge=le}])});
//# sourceMappingURL=cassette-core.min.js.map